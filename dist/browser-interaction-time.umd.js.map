{"version":3,"file":"browser-interaction-time.umd.js","sources":["../src/browser-interaction-time.ts"],"sourcesContent":["interface BaseTimeEllapsedCallbackData {\n  callback: (timeInMs: number, active: boolean) => void\n  timeInMilliseconds: number\n}\n\ntype BasicCallback = (timeInMs: number, active: boolean) => void\n\nexport interface TimeIntervalEllapsedCallbackData\n  extends BaseTimeEllapsedCallbackData {\n  multiplier: (time: number) => number\n}\n\nexport interface AbsoluteTimeEllapsedCallbackData\n  extends BaseTimeEllapsedCallbackData {\n  pending: boolean\n}\n\ninterface Settings {\n  timeIntervalEllapsedCallbacks?: TimeIntervalEllapsedCallbackData[]\n  absoluteTimeEllapsedCallbacks?: AbsoluteTimeEllapsedCallbackData[]\n  browserTabInactiveCallbacks?: BasicCallback[]\n  browserTabActiveCallbacks?: BasicCallback[]\n  idleTimeoutMs?: number\n  checkCallbacksIntervalMs?: number,\n  times?: [],\n  timesIdle?: [],\n  localKey?: string,\n  sourceUrl?: string,\n  targetUrl?: string\n}\ninterface Times {\n  start: number\n  stop: number | null\n}\n\ninterface Mark {\n  time: number\n}\n\ninterface Marks {\n  [key: string]: Mark[]\n}\n\ninterface Measure {\n  name: string\n  startTime: number\n  duration: number\n}\n\ninterface Measures {\n  [key: string]: Measure[]\n}\nconst windowIdleEvents = ['scroll', 'resize']\nconst documentIdleEvents = [\n  'wheel',\n  'keydown',\n  'keyup',\n  'mousedown',\n  'mousemove',\n  'touchstart',\n  'touchmove',\n  'click',\n  'contextmenu'\n]\n\nexport default class BrowserInteractionTime {\n  private running: boolean;\n  private times: Times[];\n  private timesIdle: Times[];\n  private idle: boolean;\n  private checkCallbackIntervalId?: number;\n  private currentIdleTimeMs: number;\n\n  private idleTimeoutMs: number;\n  private checkCallbacksIntervalMs: number;\n  private browserTabActiveCallbacks: BasicCallback[];\n  private browserTabInactiveCallbacks: BasicCallback[];\n  private timeIntervalEllapsedCallbacks: TimeIntervalEllapsedCallbackData[];\n  private absoluteTimeEllapsedCallbacks: AbsoluteTimeEllapsedCallbackData[];\n  private marks: Marks;\n  private measures: Measures;\n  private localKey: string;\n  private guidKey: string;\n  private guid: string;\n  private sourceUrl: string | boolean;\n  private targetUrl: string | boolean;\n\n  constructor({\n    timeIntervalEllapsedCallbacks,\n    absoluteTimeEllapsedCallbacks,\n    checkCallbacksIntervalMs,\n    browserTabInactiveCallbacks,\n    browserTabActiveCallbacks,\n    times,\n    timesIdle,\n    localKey,\n    idleTimeoutMs,\n    sourceUrl,\n    targetUrl\n  }: Settings) {\n    this.running = false;\n    this.times = times || [];\n    this.timesIdle = timesIdle || [];\n    this.idle = false;\n    this.currentIdleTimeMs = 0;\n    this.marks = {};\n    this.measures = {};\n    this.browserTabActiveCallbacks = browserTabActiveCallbacks || [];\n    this.browserTabInactiveCallbacks = browserTabInactiveCallbacks || [];\n    this.checkCallbacksIntervalMs = checkCallbacksIntervalMs || 100;\n    this.idleTimeoutMs = idleTimeoutMs || 3000 // 3s;\n    this.timeIntervalEllapsedCallbacks = timeIntervalEllapsedCallbacks || [];\n    this.absoluteTimeEllapsedCallbacks = absoluteTimeEllapsedCallbacks || [];\n    this.localKey = localKey || 'XXXX';\n    this.guidKey = 'browserTabGuid-' + this.localKey;\n    this.guid = this.generateGuid();\n    this.sourceUrl = sourceUrl || false;\n    this.targetUrl = targetUrl || false;\n\n    this.registerEventListeners();\n    this.setCurrentGuid();\n  }\n\n  private generateGuid = () => {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n      /*eslint-disable*/\n      let r = Math.random() * 16 | 0,\n        v = c == 'x' ? r : (r & 0x3 | 0x8);\n      /*eslint-enable*/\n      return v.toString(16);\n    });\n  }\n\n  private onBrowserTabInactive = (event: Event) => {\n    // if running pause timer\n    if (this.isRunning()) {\n      this.stopTimer();\n    }\n\n    this.browserTabInactiveCallbacks.forEach(fn =>\n      fn(this.getTimeInMillisecondsOf(BrowserInteractionTime.getIdleTimesObject(this.localKey)), false)\n    )\n  }\n\n  private onBrowserTabActive = (event: Event) => {\n    setTimeout(() => {\n      // if not running start timer\n      if (!this.isRunning()) {\n        this.running = true\n        if (this.getCurrentGuid() !== this.guid) {\n          this.setCurrentGuid();\n          this.timesIdle = BrowserInteractionTime.getIdleTimesObject(this.localKey, (times: any) => JSON.parse(times));\n          this.timesIdle[this.timesIdle.length - 1].stop = this.timesIdle[this.timesIdle.length - 1].start;\n          this.stopTimer(false);\n        }\n        this.startTimer();\n      } else if (this.isRunning() && this.guid !== this.getCurrentGuid()) {\n        this.setCurrentGuid();\n        this.timesIdle = BrowserInteractionTime.getIdleTimesObject(this.localKey, (times: any) => JSON.parse(times));\n        this.startTimer();\n      }\n\n      this.browserTabActiveCallbacks.forEach(fn => {\n        fn(this.getTimeInMillisecondsOf(BrowserInteractionTime.getActiveTimesObject(this.localKey)), true)\n      }\n      )\n    }, 100);\n  }\n\n  private onTimePassed = () => {\n    let timesActiveStoraged = BrowserInteractionTime.getActiveTimesObject(this.localKey);\n    let timesIdleStoraged = BrowserInteractionTime.getIdleTimesObject(this.localKey);\n\n    if (timesActiveStoraged == null) {\n      this.storageTimesObject(this.localKey, this.times, true);\n    }\n\n    if (timesIdleStoraged == null) {\n      this.storageTimesObject(this.localKey, this.timesIdle, false);\n    }\n\n    if (this.guid !== this.getCurrentGuid()) {\n      this.times = BrowserInteractionTime.getActiveTimesObject(this.localKey, (time: string) => JSON.parse(time));\n      this.timesIdle = BrowserInteractionTime.getIdleTimesObject(this.localKey, (timeIdle: string) => JSON.parse(timeIdle));\n    }\n    // check all callbacks time and if passed execute callback\n    if (this.getCurrentGuid() == this.guid) {\n      this.absoluteTimeEllapsedCallbacks.forEach(\n        ({ callback, pending, timeInMilliseconds }, index) => {\n          if (pending && timeInMilliseconds <= this.getTimeInMillisecondsOf(BrowserInteractionTime.getActiveTimesObject(this.localKey))) {\n            if (!this.running) {\n              callback(this.getTimeInMillisecondsOf(BrowserInteractionTime.getIdleTimesObject(this.localKey)), false);\n            } else {\n              callback(this.getTimeInMillisecondsOf(BrowserInteractionTime.getActiveTimesObject(this.localKey)), true);\n            }\n            this.absoluteTimeEllapsedCallbacks[index].pending = false\n          }\n        }\n      )\n\n      this.timeIntervalEllapsedCallbacks.forEach(\n        ({ callback, timeInMilliseconds, multiplier }, index) => {\n          if (timeInMilliseconds <= this.getTimeInMillisecondsOf(BrowserInteractionTime.getActiveTimesObject(this.localKey))) {\n            if (!this.running) {\n              callback(this.getTimeInMillisecondsOf(BrowserInteractionTime.getIdleTimesObject(this.localKey)), false);\n            } else if (this.running && !this.idle) {\n              callback(this.getTimeInMillisecondsOf(BrowserInteractionTime.getActiveTimesObject(this.localKey)), true);\n            }\n            this.timeIntervalEllapsedCallbacks[\n              index\n            ].timeInMilliseconds = multiplier(timeInMilliseconds)\n          }\n        }\n      )\n\n      if (this.currentIdleTimeMs >= this.idleTimeoutMs && this.isRunning()) {\n        this.idle = true;\n        this.stopTimer();\n      } else {\n        this.currentIdleTimeMs += this.checkCallbacksIntervalMs;\n      }\n    }\n  }\n\n  private resetIdleTime = () => {\n    if (this.idle) {\n      this.startTimer()\n    }\n    this.idle = false\n    this.currentIdleTimeMs = 0\n  }\n\n  private registerEventListeners = () => {\n    const documentListenerOptions = { passive: true }\n    const windowListenerOptions = { ...documentListenerOptions, capture: true }\n\n    window.addEventListener(\n      'blur',\n      this.onBrowserTabInactive,\n      windowListenerOptions\n    )\n    window.addEventListener(\n      'focusout',\n      this.onBrowserTabInactive,\n      windowListenerOptions\n    )\n    window.addEventListener(\n      'focus',\n      this.onBrowserTabActive,\n      windowListenerOptions\n    )\n    window.addEventListener(\n      'beforeunload',\n      (e) => {\n        e.preventDefault();\n        console.log(this.guid + ' <-- ADIOS')\n      },\n      windowListenerOptions\n    )\n\n    const throttleResetIdleTime = () => setTimeout(this.resetIdleTime, 100);\n\n    windowIdleEvents.forEach(event => {\n      window.addEventListener(\n        event,\n        throttleResetIdleTime,\n        windowListenerOptions\n      )\n    })\n\n    documentIdleEvents.forEach(event =>\n      document.addEventListener(\n        event,\n        throttleResetIdleTime,\n        documentListenerOptions\n      )\n    )\n  }\n\n  private unregisterEventListeners = () => {\n    window.removeEventListener('blur', this.onBrowserTabInactive)\n    window.removeEventListener('focus', this.onBrowserTabActive)\n    windowIdleEvents.forEach(event =>\n      window.removeEventListener(event, this.resetIdleTime)\n    )\n\n    documentIdleEvents.forEach(event =>\n      document.removeEventListener(event, this.resetIdleTime)\n    )\n  }\n\n  private checkCallbacksOnInterval = () => {\n    this.checkCallbackIntervalId = window.setInterval(() => {\n      this.onTimePassed()\n    }, this.checkCallbacksIntervalMs)\n  }\n\n  private getCurrentGuid = () => {\n    return localStorage.getItem(this.guidKey);\n  }\n\n  private setCurrentGuid() {\n    localStorage.setItem(this.guidKey, this.guid);\n  }\n\n  public static getActiveTimesObject(key: string, cb?: Function) {\n    let activeTime = localStorage.getItem('browserTimeActiveObject-' + key);\n    if (cb) {\n      return cb(activeTime);\n    } else {\n      return activeTime;\n    }\n  }\n\n  public static getIdleTimesObject(key: string, cb?: Function) {\n    let idleTime = localStorage.getItem('browserTimeIdleObject-' + key);\n    if (cb) {\n      return cb(idleTime);\n    } else {\n      return idleTime;\n    }\n  }\n\n  public startTimer = () => {\n    if (!this.isRunning() && this.guid == this.getCurrentGuid()) {\n      this.running = true\n    }\n    if (!this.checkCallbackIntervalId) {\n      this.checkCallbacksOnInterval()\n    }\n\n    const last = this.times[this.times.length - 1]\n    if (last && last.stop === null) {\n      return\n    }\n\n    if (this.timesIdle.length > 1) {\n      if (performance.now() < this.timesIdle[this.timesIdle.length - 1].start) {\n        this.timesIdle[this.timesIdle.length - 1].stop = this.timesIdle[this.timesIdle.length - 1].start;\n      } else {\n        this.timesIdle[this.timesIdle.length - 1].stop = performance.now();\n      }\n      this.storageTimesObject(this.localKey, this.timesIdle, false);\n    }\n\n    this.times.push({\n      start: performance.now(),\n      stop: null\n    });\n\n    this.storageTimesObject(this.localKey, this.times, true);\n  }\n\n  public stopTimer = (stopTimeActive: boolean = true) => {\n    if (!this.times.length) {\n      return;\n    }\n    this.running = false;\n\n    const last = this.timesIdle[this.timesIdle.length - 1]\n    if (last && last.stop === null) {\n      return\n    }\n\n    if (stopTimeActive) {\n      this.times[this.times.length - 1].stop = performance.now();\n      this.storageTimesObject(this.localKey, this.times, true);\n    }\n    this.timesIdle.push({\n      start: performance.now(),\n      stop: null\n    });\n    this.storageTimesObject(this.localKey, this.timesIdle, false);\n\n  }\n\n  public addTimeIntervalEllapsedCallback = (\n    timeIntervalEllapsedCallback: TimeIntervalEllapsedCallbackData\n  ) => {\n    this.timeIntervalEllapsedCallbacks.push(timeIntervalEllapsedCallback)\n  }\n\n  public addAbsoluteTimeEllapsedCallback = (\n    absoluteTimeEllapsedCallback: AbsoluteTimeEllapsedCallbackData\n  ) => {\n    this.absoluteTimeEllapsedCallbacks.push(absoluteTimeEllapsedCallback)\n  }\n\n  public addBrowserTabInactiveCallback = (\n    browserTabInactiveCallback: BasicCallback\n  ) => {\n    this.browserTabInactiveCallbacks.push(browserTabInactiveCallback)\n  }\n\n  public addBrowserTabActiveCallback = (\n    browserTabActiveCallback: BasicCallback\n  ) => {\n    this.browserTabActiveCallbacks.push(browserTabActiveCallback)\n  }\n\n  public getTimeInMilliseconds = (): number => {\n    return this.times.reduce((acc, current) => {\n      if (current.stop) {\n        acc = acc + (current.stop - current.start)\n      } else {\n        acc = acc + (performance.now() - current.start)\n      }\n      return acc\n    }, 0)\n  }\n\n  public getTimeInMillisecondsOf = (times: any): number => {\n    return JSON.parse(times).reduce((acc: any, current: any) => {\n      if (current.stop) {\n        acc = acc + (current.stop - current.start)\n      } else {\n        acc = acc + (performance.now() - current.start)\n      }\n      return acc\n    }, 0)\n  }\n\n  public getIdleTimeInMilliseconds = (): number => {\n    return this.timesIdle.reduce((acc, current) => {\n      if (current.stop) {\n        acc = acc + (current.stop - current.start)\n      } else {\n        acc = acc + (performance.now() - current.start)\n      }\n      return acc\n    }, 0)\n  }\n\n  public isRunning = () => {\n    return this.running\n  }\n\n  public reset = () => {\n    this.times = []\n  }\n\n  public destroy = () => {\n    this.unregisterEventListeners()\n    if (this.checkCallbackIntervalId) {\n      window.clearInterval(this.checkCallbackIntervalId)\n    }\n  }\n\n  public mark(key: string) {\n    if (!this.marks[key]) {\n      this.marks[key] = []\n    }\n    this.marks[key].push({ time: this.getTimeInMillisecondsOf(BrowserInteractionTime.getActiveTimesObject(this.localKey)) })\n  }\n\n  public getMarks(name: string) {\n    if (this.marks[name].length < 1) {\n      return\n    }\n\n    return this.marks[name]\n  }\n\n  public measure(name: string, startMarkName: string, endMarkName: string) {\n    const startMarks = this.marks[startMarkName]\n    const startMark = startMarks[startMarks.length - 1]\n    const endMarks = this.marks[endMarkName]\n    const endMark = endMarks[endMarks.length - 1]\n\n    if (!this.measures[name]) {\n      this.measures[name] = []\n    }\n\n    this.measures[name].push({\n      name,\n      startTime: startMark.time,\n      duration: endMark.time - startMark.time\n    })\n  }\n\n  public getMeasures(name: string) {\n    if (!this.measures[name] && this.measures[name].length < 1) {\n      return\n    }\n\n    return this.measures[name]\n  }\n\n  public static storageTime = (key: string) => (time: any, active: any) => {\n    if (active) {\n      localStorage.setItem('browserTimeActive-' + key, (time).toString());\n    } else if (!active) {\n      localStorage.setItem('browserTimeIdle-' + key, (time).toString());\n    }\n  };\n\n  public storageTimesObject = (key: string, times: any, active: boolean = true) => {\n    if (active) {\n      localStorage.setItem('browserTimeActiveObject-' + key, JSON.stringify(times));\n    } else if (!active) {\n      localStorage.setItem('browserTimeIdleObject-' + key, JSON.stringify(times));\n    }\n  };\n\n  public static initTimer(time: string) {\n    return time == null ? [] : [{\n      start: performance.now(),\n      stop: (parseFloat(time))\n    }];\n  }\n\n  public static getActiveTime = (key: string, cb?: Function) => {\n    let activeTime = localStorage.getItem('browserTimeActive-' + key);\n    if (cb) {\n      return cb(activeTime);\n    } else {\n      return activeTime;\n    }\n  }\n\n  public static getIdleTime = (key: string, cb?: Function) => {\n    let idleTime = localStorage.getItem('browserTimeIdle-' + key);\n    if (cb) {\n      return cb(idleTime);\n    } else {\n      return idleTime;\n    }\n  }\n}\n"],"names":[],"mappings":"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"}